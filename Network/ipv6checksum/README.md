# チェックサム計算について

IPv6ではチェックサム計算を含まない。
ただし、TCP/UDP/ICMPv6といった「通常考えられるメッセージ」
にはチェックサムが含まれると考えてよい。

ICMPv6は「L3ではない」として扱う。
すなわち、今や、ICMPv6メッセージはL4として扱う。
ここで、RFC 2460を参照する。
8.1 Upper-Layer Checksumsにおいて、以下の疑似ヘッダが用いられる。
何故疑似ヘッダが必要か？という問いについては、


```
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                                                               +
   |                                                               |
   +                         Source Address                        +
   |                                                               |
   +                                                               +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                                                               +
   |                                                               |
   +                      Destination Address                      +
   |                                                               |
   +                                                               +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   Upper-Layer Packet Length                   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      zero                     |  Next Header  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```


Addressはアドレスが入る。
Upper-Layer Packet LengthについてはTCP/UDP/ICMPv6の「ヘッダからデータまでの長さ」として考えてよい。
Next Headerは上位プロトコル番号、TCP(6), UDP(17)であり、ICMPv6は特に(58)となる。
なお、16真数「ではない」ことに注意」

特に、ICMPv6については次の通りとなる。

```
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Code      |          Checksum             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

擬似ヘッダとICMPv6の最初から(Type -> Code -> ChecksumからはじめてICMPv6のペイロードの「最後まで」)
の1 の補数の合計の 16 ビットの 1 の補数である。